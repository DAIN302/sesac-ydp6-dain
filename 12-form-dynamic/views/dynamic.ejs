<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>동적 form 전송</title>
    <!-- jQuery CDN (ajax 사용 위헤 불러옴) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>
    <h1><%= title%></h1>
    <!-- 페이지 전송이 일어나지 않으므로 action 사용 X -->
    <form name="register">
        <label for="name">이름</label>
        <input type="text" name="name" id="name">
        <br>
        <span>성별</span>
        <input type="radio" name="gender" id="male" value="남성">
        <label for="male">남성</label>
        <input type="radio" name="gender" id="female" value="여성">
        <label for="female">여성</label>
        <br>
        <button type="button" onclick="ajaxGet()">ajax get 방식 요청</button>
        <button type="button" onclick="ajaxPOST()">ajax post 방식 요청</button>
    </form>
    <div class="result"></div>
    <script>
        const resultBox = document.querySelector(".result");

        // ajax get 방식 요청하는 함수
        function ajaxGet(){
            // 1. 폼 요소 선택
            const form = document.forms['register']
            
            // 2. 폼 요소의 값 추출
            // console.dir(form); // console.dir() html 요소를 객체처럼 트리구조로 출력해줌(계층적인 목록으로 나타냄)
            // console.dir(form.gender.value); 

            // 서버로 보낼 데이터 양식 생성
            const data = {
                name : form.name.value,
                gender : form.gender.value
            }


            // 3. ajax 비동기 통신 GET 방식
            // (서버의 index.js 파일로 유저가 브라우저에 입력한 값을 보내기)
            $.ajax({
                type : 'GET', // get 방식으로 요청을 보낼 것이다.
                url : '/ajax', // form 태그의 action 역할 -> 요청을 받을 서버 측 경로
                data, // key-value 값이 동일하면 생략해서 하나만 써도 됨 data: data와 동일
                success : function(data){ // server 에서 req.query 로 받은 데이터를 여기서 받는다.
                    console.log(data);
                    resultBox.textContent = 
                    `GET ajax 요청에 대한 응답 완료 ${data.name}님은 ${data.gender}이시죠?`
                    resultBox.style.color = 'blue';
                }
            })
        }

        // ajax post 방식 요청하는 함수
        function ajaxPOST(){
            // 1. 폼 요소 선택
            const form = document.forms['register']

            // 2. 폼 요소 값 추출
            const data = {
                name : form.name.value,
                gender : form.gender.value
            }

             // 3. ajax 비동기 통신 POST 방식
             $.ajax({
                type : 'POST', // post 방식으로 요청을 보낼 것이다.
                url : '/ajax', 
                data, 
                success : function(data){ // server 에서 req.query 로 받은 데이터를 여기서 받는다.
                    console.log(data);
                    resultBox.textContent = 
                    `POST ajax 요청에 대한 응답 완료 ${data.name}님은 ${data.gender}이시죠?`
                    resultBox.style.color = 'red';
                }
            })
        }
    </script>
</body>
</html>